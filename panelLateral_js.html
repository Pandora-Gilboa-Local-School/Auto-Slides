<!-- jQuery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<!-- Materialize -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

<script>
  
  // Evento de documento listo
  $(function() {
  
      // Inicialiar todos los componententes Materialize
      
      M.AutoInit();
  
      // Asignar manejador botón guardar cambios
      
      $('#botonGuardar').prop('disabled', true);
      $('#botonGuardar').click(on_botonGuardar);
      $('#botonReset').click(on_botonReset);
      
      // Reactivar botón en cuanto se modifica algún ajuste
      $('input').change(() =>  {$('#botonGuardar').prop('disabled', false);})  
      
  });
  
  function on_botonGuardar() {
    
    // Desactivar botón
    
    $('#botonGuardar').prop('disabled', true);
    
    // Devolver valores a servidor, se pasa objeto DOM form como parámetro directamente
    
    google.script.run
      .withSuccessHandler(function() {
        M.toast({html: '✔️ Saved Settings'});
        // google.script.host.close();
      })
      .withFailureHandler(function() {
        M.toast({html: '❌ Error performing operation'});
        $('#botonGuardar').prop('disabled', false);
      })
      .actualizarAjustes($('#formConfigurar').get(0));
  }
  
  function on_botonReset() {

  // Reajustar valores de configuración por defecto
  
  // Desactivar botón
    
  $('#botonReset').prop('disabled', true);
  
    google.script.run
      .withSuccessHandler(function(ajustes) {
        M.toast({html: '✔️ Original settings restored'});
        $('#sAdvance').prop('value', ajustes.sAdvance);
        $('#sReload').prop('value', ajustes.sReload);
        $('#msFade').prop('value', ajustes.msFade);
        $('#backgroundColor').prop('value', ajustes.backgroundColor);
        $('#start').prop('checked', ajustes.start == 'on' ? true : false);
        $('#repeat').prop('checked', ajustes.repeat == 'on' ? true : false);
        $('#hideMenu').prop('checked', ajustes.hideMenu == 'on' ? true : false);
        $('#hideBands').prop('checked', ajustes.hideBands == 'on' ? true : false);
        $('#hideBorders').prop('checked', ajustes.hideBorders == 'on' ? true : false);
        $('#botonGuardar').prop('disabled', true);
        $('#botonReset').prop('disabled', false);

      })
      .withFailureHandler(function() {
        M.toast({html: '❌ Error performing operation'});
        $('#botonReset').prop('disabled', false);
      })
      .ajustesPorDefecto();  
  
  }
    
</script>